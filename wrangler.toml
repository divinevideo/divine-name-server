name = "divine-name-server"
main = "src/index.ts"
compatibility_date = "2024-11-15"

# Routes (must be top-level, before any [section] headers)
routes = [
  { pattern = "divine.video/.well-known/*", zone_name = "divine.video" },
  { pattern = "names.admin.divine.video/*", zone_name = "divine.video" },
  { pattern = "names.divine.video/*", zone_name = "divine.video" }
]

# Fastly KV sync (for divine-router edge)
# Set via wrangler secret put FASTLY_API_TOKEN
# Set via wrangler secret put FASTLY_STORE_ID

# Payment/invite gate for public name reservations
# ALLOWED_MINTS: comma-separated list of trusted Cashu mint URLs (e.g. "https://mint.example.com")
# NAME_PRICE_SATS: minimum sat amount required to reserve a name (default: 1000)
# INVITE_FAUCET_URL: base URL of the invite code faucet service (e.g. "https://faucet.example.com")
# Set via wrangler secret put SENDGRID_API_KEY
[vars]
# FASTLY_STORE_ID = "your-store-id" # Set as secret in production
# ALLOWED_MINTS = "https://8333.space:3338,https://mint.minibits.cash/Bitcoin"
# NAME_PRICE_SATS = "1000"
# INVITE_FAUCET_URL = "https://faucet.divine.video"

[[d1_databases]]
binding = "DB"
database_name = "divine-name-server-db"
database_id = "e7e081c4-830d-449c-9de5-d93eaacefb34"

# Hourly reconciliation of D1 -> Fastly KV
[triggers]
crons = ["0 * * * *"]

# Admin UI static assets
[assets]
directory = "./admin-ui/dist"
binding = "ASSETS"
